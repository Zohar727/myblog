---
title: 浅析堆栈&JS中的堆栈
date: 2020-03-25 19:56:07
banner: https://images.unsplash.com/photo-1584847642268-a34ebb908ccf?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1349&q=80
thumbnail: https://images.unsplash.com/photo-1584847642268-a34ebb908ccf?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1349&q=80
tags:
- JavaScript
categories:
- JavaScript
toc: true
---
### 数据结构中的堆栈
**栈**：在数据结构中，栈是一种先进后出的数据结构  。栈这种数据结构就像一叠放在箱子的书，我们想取最下面的书，必须要移开上面的书（放入比较晚的书）。
<!--more-->
**堆**：堆是一种**经过排序的树形数据结构**，每个节点都有一个值。通常我们所说的堆的数据结构，是指二叉堆。堆的特点是根节点的值最小（或者最大），且根节点的两个子树也是一个堆。由于堆的这个特性，常用于实现优先队列。**堆的存取是随意**的，就如同我们在图书馆的书架上取书，虽然书的摆放是有顺序的，但是我们想取任意一本书不必像栈一样，必须先取出前面所有的书。

### 内存分配中的堆栈
##### 1.内存申请和释放方式不同
**栈**：栈的内存是由系统自动分配释放的，且栈是连续的。
**堆**：堆的内存是有程序员分配释放的，如c语言中的malloc行数，如果程序员不释放，则会在程序结束后由OS释放
##### 2.申请后的系统响应
**栈**：只要栈的剩余空间大于所申请的空间，系统就将为其分配内存，否则将报异常**栈溢出**。  
**堆**：操作系统有一个记录空闲内存地址的链表，当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点中删除，并将该结点的空间分配给程序。另外，对于大多数系统，会在这块内存空间的首地址处记录本次分配的大小，这样，代码中的delete语句才能正确的释放内存空间。由于找到的堆结点大小不一定正好等于申请的大小，系统会自动的**将多余的空间重新释放到空闲链表中**，这也进而导致了碎片化的问题。
##### 3.申请效率比较
有1，2可以知道：  
**栈**是由系统自动分配的，速度较快，程序员无法控制；  
**堆**是由`new`分配的内存，一般速度较慢，而且容易产生数据碎片。
##### 4.申请空间大小的限制
**栈**：在windows下，栈是向低地址扩展的数据结构，且是一块**连续的内存区域**，这句话的意思就是说**栈顶的地址和栈的最大容量是系统预先设定好的**，在windows下，栈的大小一般是2M或1M。如果申请空间大于栈的剩余空间时，将提示栈溢出。因此，**能从栈获取到的空间较小**；  
**堆**：堆是向高地址扩展的数据结构，**且是不连续的内存区域**。这是由于系统是用链表来存储空闲内存地址的，自然是不连续的，而链表的遍历方向是由地址向高地址遍历。堆的大小受限于计算机系统有效的虚拟内存。由此可见，**堆获得空间比较灵活，也比较大**。
##### 5.存储内容比较
**栈**：在函数调用时，第一个入栈的是**主函数调用后的下一条指令**（函数调用语句的下一条可执行语句）的地址，然后是函数的各个参数，在大多数C编译器中，参数是由右往左入栈的，然后是函数中的局部变量。**静态变量**是不入栈的；
**堆**：一般是在堆的头部一个字节存放堆的大小，其它具体内容由程序员安排。

#### JS中的栈内存和堆内存
**栈内存**：存储基本类型的变量（boolean,number,string,undefined,null）以及对象的指针。这些类型在内存中占有固定大小的空间，因此他们的值保存在栈中。  
**堆内存**：存储引用类型（对象、数组、函数）的数据实体，引用类型的值大小不固定，适合存储在堆中。

![img](http://file.zohar.com.cn/blog/461976-20180823211511434-1707579794.png)
引用类型的数据实体存放在堆中，而它的地址指针存储在栈中。通常我们访问一个引用类型的值，会先从栈中取得该对象的地址指针，然后根据地址在堆中取到对应的数据。

#### 传值和传址
那么JS中传参是传值还是传址呢？  
针对基本数据类型，是传值的；  
针对复杂数据类型（如对象，数组），是传值的，因为复杂数据类型存储在栈中的值就是地址指针，所以传过去的是对象的引用地址。

#### 参考文献
[C语言堆栈入门——堆和栈的区别](https://www.cnblogs.com/jiahuafu/p/8575044.html)  
[浅析JS中的堆内存与栈内存](https://www.cnblogs.com/heioray/p/9487093.html)  
[JS的堆和栈](https://blog.csdn.net/jingge_nihao/article/details/80326128)